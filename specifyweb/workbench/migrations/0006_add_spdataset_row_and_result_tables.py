# Generated by Django 2.2.10 on 2021-07-20 15:19

from django.db import migrations, models
from django.db.models.indexes import Index
import django.db.models.deletion
import django_jsonfield_backport.models # type: ignore


class Migration(migrations.Migration):

    dependencies = [
        ('workbench', '0005_auto_20210428_1634'),
    ]

    operations = [
        migrations.RenameField(
            model_name='spdataset',
            old_name='rowresults',
            new_name='rowresults_old',
        ),
        migrations.AlterField(
            model_name='spdataset',
            name='rowresults_old',
            field=models.TextField(db_column='rowresults', null=True),
        ),
        migrations.CreateModel(
            name='Spdatasetrowresult',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rownumber', models.IntegerField()),
                ('result', models.TextField()),
                ('spdataset', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rowresults', to='workbench.Spdataset')),
            ],
            options={
                'db_table': 'spdatasetrowresult',
                'ordering': ['rownumber'],
            },
        ),
        migrations.CreateModel(
            name='Spdatasetrow',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rownumber', models.IntegerField()),
                ('data', django_jsonfield_backport.models.JSONField()),
                ('spdataset', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rows', to='workbench.Spdataset')),
            ],
            options={
                'db_table': 'spdatasetrow',
                'ordering': ['rownumber'],
            },
        ),
        migrations.AddConstraint(
            model_name='spdatasetrowresult',
            constraint=models.UniqueConstraint(fields=('spdataset', 'rownumber'), name='unique_rownumber_result'),
        ),
        migrations.AddConstraint(
            model_name='spdatasetrow',
            constraint=models.UniqueConstraint(fields=('spdataset', 'rownumber'), name='unique_rownumber_row'),
        ),
        migrations.AddIndex('Spdatasetrow', Index(fields=['spdataset'], name='row_spdataset_idx')),
        migrations.AddIndex('Spdatasetrowresult', Index(fields=['spdataset'], name='rowresult_spdataset_idx')),
    ]
